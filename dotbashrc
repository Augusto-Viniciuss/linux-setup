# create alisases
alias ra='ranger'

# set editor and shell
export EDITOR=vim
export SHELL=/bin/bash

# the location of `once generated ctags file`
export CTAGS_FILE_ONCE="~/tags-once" 

export TERM="xterm-256color"                                                                          

# allows killing tmux by exiting the window                                                           
alias tmuxn='tmux new-session -s $$'                                                       
_trap_exit() { tmux kill-session -t $$; }                                                       
trap _trap_exit EXIT                                                                                  

# allows killing process with all its children
killp () {

  if [ $# -eq 0 ]; then
    pes=$( cat ) 
  else
    pes=$1
  fi
  
	for child in $(ps -o pid,ppid -ax | \
   awk "{ if ( \$2 == $pes ) { print \$1 }}")
  do
    # echo "Killing child process $child because ppid = $pes"
    killp $child
  done
        
  # echo "killing $1"
  kill -9 "$1" > /dev/null 2> /dev/null
}

alias sb="source ~/.bashrc"

# use ctags to generate code tags
generateTags() {

  # generate project's tags
  # TODO check for file existence
  ctagscmd="ctags -f ~/tags $CTAGS_SOURCE_DIR"
  eval $ctagscmd

  # generate `once generated tags`, e.g. ROS's tags
  if [ ! -e $(eval echo "$CTAGS_FILE_ONCE") ]; then
    echo "generating one-time generated tags"
    ctagscmd="ctags -f $CTAGS_FILE_ONCE $CTAGS_ONCE_SOURCE_DIR"
    eval $ctagscmd
  fi 
}

# VIM alias for running vim in tmux and in servermode
runvim() {

  # if the tmux session does not exist, create new and run vim in it
  if [ -z $TMUX ]; then
    { generateTags & disown; } 2> /dev/null
    vimcmd="vim --servername dog ${@}"
    tmux new-session -s $$ -d $vimcmd \; attach

    # create trap for exiting the tmux session when the windows is closed
    _trap_exit() { tmux kill-session -t $$; }                                                      
    trap _trap_exit EXIT                                                                          
  else
    # just run vim if the session exists
    { generateTags & disown; } 2> /dev/null
    vim $@ --servername dog
  fi
}
alias vim=runvim

# exit alias
alias :q=exit

# source tmuxinator
source $GIT_PATH/linux-setup/submodules/tmuxinator/completion/tmuxinator.bash

# load tmux automatically                                                                             
if [ "$RUN_TMUX" = "true" ]; then
  if command -v tmux>/dev/null; then                                                                    
    if [ ! -z "$PS1" ]; then # unless shell not loaded interactively, run tmux                          
      [[ ! $TERM =~ screen ]] && [ -z $TMUX ] && tmuxn                                                  
    fi                                                                                                  
  fi
fi
